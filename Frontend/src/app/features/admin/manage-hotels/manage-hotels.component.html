<div class="page-header">
  <h2>Manage Hotels</h2>
  <button class="btn-add" (click)="openAddModal()">
    <i class="fa-solid fa-plus"></i> Add Hotel
  </button>

  <div class="search-bar">
  <input type="number" placeholder="Search by ID..." [(ngModel)]="searchId">

  <button class="btn-search" (click)="searchHotel()">
    <i class="fa-solid fa-magnifying-glass"></i>
  </button>

  @if (isSearching) {
    <button class="btn-reset" (click)="loadHotels()">
      <i class="fa-solid fa-rotate-left"></i> Reset
    </button>
  }
  </div>

</div>


@if (isLoading) {
  <div class="loading-state">
    <i class="fa-solid fa-circle-notch fa-spin"></i> Loading hotels...
  </div>
} @else {

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>ID</th>
          <th>Name</th>
          <th>City</th>
          <th class="actions-col">Actions</th>
        </tr>
      </thead>
      <tbody>
        @for (hotel of hotels; track hotel.id) {
          <tr>
            <td>#{{ hotel.id }}</td>
            <td class="fw-bold">{{ hotel.name }}</td>
            <td>{{ hotel.city }}</td>
            <td>
              <div class="action-buttons">
                <button class="btn-icon edit" (click)="openEditModal(hotel)">
                  <i class="fa-solid fa-pen"></i>
                </button>
                <button class="btn-icon delete" title="Delete" (click)="deleteHotel(hotel.id)">
                  <i class="fa-solid fa-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        }
      </tbody>
    </table>

    @if (hotels.length === 0) {
      <div class="empty-state">
        No hotels found. Click "Add Hotel" to create one.
      </div>
    }
  </div>

}

@if (showModal) {
  <div class="modal-overlay">
    <div class="modal-card">
      <div class="modal-header">
        <h3>{{ isEditing ? 'Edit Hotel' : 'Add New Hotel' }}</h3>
        <button class="btn-close" (click)="closeModal()"><i class="fa-solid fa-xmark"></i></button>
      </div>

      <form (ngSubmit)="hotelForm.form.valid && saveHotel()" #hotelForm="ngForm">

        <div class="form-group">
          <label>Name <span class="text-danger">*</span></label>
          <input
            type="text"
            [(ngModel)]="currentHotel.name"
            name="name"
            required
            minlength="3"
            #nameCtrl="ngModel"
            [class.is-invalid]="nameCtrl.invalid && (nameCtrl.dirty || nameCtrl.touched)"
          >
          @if (nameCtrl.invalid && (nameCtrl.dirty || nameCtrl.touched)) {
            <div class="error-text">
              @if (nameCtrl.errors?.['required']) { Name is required. }
              @if (nameCtrl.errors?.['minlength']) { Name must be at least 3 characters. }
            </div>
          }
        </div>

        <div class="form-group">
          <label>Address <span class="text-danger">*</span></label>
          <input
            type="text"
            [(ngModel)]="currentHotel.address"
            name="address"
            required
            #addressCtrl="ngModel"
            [class.is-invalid]="addressCtrl.invalid && (addressCtrl.dirty || addressCtrl.touched)"
          >
          @if (addressCtrl.invalid && (addressCtrl.dirty || addressCtrl.touched)) {
            <div class="error-text">Address is required.</div>
          }
        </div>

        <div class="row">
          <div class="col form-group">
            <label>City <span class="text-danger">*</span></label>
            <input
              type="text"
              [(ngModel)]="currentHotel.city"
              name="city"
              required
              #cityCtrl="ngModel"
              [class.is-invalid]="cityCtrl.invalid && (cityCtrl.dirty || cityCtrl.touched)"
            >
            @if (cityCtrl.invalid && (cityCtrl.dirty || cityCtrl.touched)) {
              <div class="error-text">City is required.</div>
            }
          </div>
          <div class="col form-group">
            <label>Country <span class="text-danger">*</span></label>
            <input
              type="text"
              [(ngModel)]="currentHotel.country"
              name="country"
              required
              #countryCtrl="ngModel"
              [class.is-invalid]="countryCtrl.invalid && (countryCtrl.dirty || countryCtrl.touched)"
            >
            @if (countryCtrl.invalid && (countryCtrl.dirty || countryCtrl.touched)) {
              <div class="error-text">Country is required.</div>
            }
          </div>
        </div>

        <div class="form-group">
          <label>Phone Number <span class="text-danger">*</span></label>
          <input
            type="text"
            [(ngModel)]="currentHotel.phoneNumber"
            name="phoneNumber"
            required
            pattern="^[0-9\-\+\s]+$"
            #phoneCtrl="ngModel"
            [class.is-invalid]="phoneCtrl.invalid && (phoneCtrl.dirty || phoneCtrl.touched)"
          >
          @if (phoneCtrl.invalid && (phoneCtrl.dirty || phoneCtrl.touched)) {
            <div class="error-text">
              @if (phoneCtrl.errors?.['required']) { Phone Number is required. }
              @if (phoneCtrl.errors?.['pattern']) { Invalid phone format. }
            </div>
          }
        </div>

        <div class="modal-footer">
          <button type="button" class="btn-cancel" (click)="closeModal()">Cancel</button>

          <button type="submit" class="btn-save" [disabled]="hotelForm.invalid">
            Save Hotel
          </button>
        </div>
      </form>
    </div>
  </div>
}
